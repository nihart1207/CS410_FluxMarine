<html>
  <head>
    <title>Update Inventory</title>
    <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/wasm@3.3.0/dist/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@hpcc-js/wasm-barcode@3.3.0/dist/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.3/dist/JsBarcode.all.min.js"></script>
  </head>
  <body>
    <h1>Update Inventory</h1>
    <input type="radio" name="option" id="add" value="Add" checked> Add<br>
    <input type="radio" name="option" id="remove" value="Remove"> Remove<br>
    <input type="radio" name="option" id="update" value="Update"> Update<br>
    <label>
        Current Location:
        <select name="location" id="location">
          <option value="">Select a location</option>
          <option value="Warehouse">Warehouse</option>
          <option value="Assembly Line">Assembly Line</option>
          <option value="Delivery">Delivery</option>
        </select>
    </label>
    <br><br>
    <h2>Current Mode</h2>
    <p id="selectedOption">Add</p>
    <br>
    <h2>Queries to Send</h2>
    <ul id="queries-list"></ul>

    <script>
        // This script is to update the Current Mode when one of the inputs is changed
      var add = document.getElementById("add");
      var remove = document.getElementById("remove");
      var update = document.getElementById("update");
      var selectedOption = document.getElementById("selectedOption");

      add.addEventListener("change", function() {
        if (add.checked) {
          selectedOption.innerHTML = add.value;
        }
      });

      remove.addEventListener("change", function() {
        if (remove.checked) {
          selectedOption.innerHTML = remove.value;
        }
      });

      update.addEventListener("change", function() {
        if (update.checked) {
          selectedOption.innerHTML = update.value;
        }
      });
    </script>

    <script>
        // this cript is to read the barcode and combine it with the current mode to display
        // a query to send
        var barcode = '';
        var interval;

        document.addEventListener('keydown', function(e) {
            if (interval)
                clearInterval(interval);
            if (e.code == 'Enter') {
                if (barcode)
                    handleBarcode(barcode);
                barcode = '';
                return;
            }
            if (e.key != 'Shift')
                barcode += e.key;
            interval = setInterval(() => barcode = '', 20);
        });
        
        // handle barcode creates the "query"
        function handleBarcode(scanned_barcode) {
            var queryList = document.getElementById("queries-list");
            var selectedOption = document.getElementById("selectedOption");
            // Create a new li element to hold the barcode and add it to the ul element
            var newBarcode = document.createElement("li");
            newBarcode.textContent += selectedOption.innerHTML;
            newBarcode.textContent += " ";
            newBarcode.textContent += barcode;
            if (selectedOption.innerHTML == "Update") {
                var location = document.getElementById("location");
                newBarcode.textContent += " to "
                newBarcode.textContent += location.value;
            };
            queryList.appendChild(newBarcode);
        }

    </script>
  </body>
</html>